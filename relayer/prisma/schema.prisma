generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model NetworkStatus {
  chain              String   @id
  lastProcessedBlock BigInt
  updatedAt          DateTime @updatedAt
}

model Nonce {
  chain String @id
  value BigInt
}

model Transaction {
  id                     Int          @id @default(autoincrement())
  sourceChain            CHAIN        @default(EVM)
  eventName              BRIDGE_EVENT @default(LOCKED_CANONICAL) // "LockedCanonical"
  sourceTxHash           String
  sourceLogIndex         Int?
  eventId                String       @unique // keccak256(...) OR `${txHash}:${logIndex}`
  sourceBlockNumber      BigInt
  token                  String
  sender                 String
  amount                 String
  netAmount              String?
  feeAmount              String?
  nonce                  BigInt?
  destChainId            String
  destAddress            String
  destinationTxHash      String?
  destinationBlockNumber BigInt?
  status                 TX_STATUS    @default(LOCKED)
  createdAt              DateTime     @default(now())
  updatedAt              DateTime     @updatedAt

  @@unique([sourceTxHash, sourceLogIndex])
}

enum CHAIN {
  EVM
  CASPER
}

enum BRIDGE_EVENT {
  LOCKED_CANONICAL
  BURNED_WRAPPED
  MINTED_WRAPPED
  UNLOCKED_CANONICAL
}

enum TX_STATUS {
  LOCKED // canonical locked on source
  BURNED // wrapped burned on source

  QUEUED // picked up by relayer
  EXECUTING // tx sent to destination chain

  EXECUTED // mint/unlock succeeded
  FAILED // execution failed (retryable)

  FINALIZED // optional: confirmed & irreversible
}
